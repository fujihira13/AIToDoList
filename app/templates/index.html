<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>アイゼンハワーボード</title>
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body>
    <header class="page-header">
      <div>
        <h1>{{ copy.page_title }}</h1>
      </div>
      <div class="header-actions">
        <button type="button" class="btn btn--primary" id="addTaskBtn">
          {{ copy.add_task }}
        </button>
        <button type="button" class="btn btn--secondary" id="addStaffBtn">
          メンバーを追加
        </button>
      </div>
    </header>

    <div class="tabs">
      <div class="tabs__header">
        <button type="button" class="tab-btn tab-btn--active" data-tab="board">
          ボード
        </button>
        <button type="button" class="tab-btn" data-tab="preview">
          プレビュー
        </button>
      </div>
      <div class="tabs__content">
        <div class="tab-panel tab-panel--active" id="boardTab">
          <main class="layout">
            <section class="board" id="board" aria-live="polite"></section>
            <aside class="staff-panel">
              <div class="staff-panel__header">
                <h2>{{ copy.staff_title }}</h2>
                <p>{{ copy.staff_sub }}</p>
              </div>
              <div id="staffList" class="staff-list"></div>
            </aside>
          </main>
        </div>
        <div class="tab-panel" id="previewTab">
          <div class="preview-container">
            <div class="quadrant-overview" id="quadrantOverview"></div>
            <section class="preview-section">
              <h2 class="preview-section__title">職員別タスク分布</h2>
              <div class="staff-distribution" id="staffDistribution"></div>
            </section>
          </div>
        </div>
      </div>
    </div>

    <dialog id="taskDialog" class="modal">
      <form id="taskForm" method="dialog">
        <header class="modal__header">
          <div>
            <h2
              id="taskFormTitle"
              data-create-label="{{ copy.form_create }}"
              data-edit-label="{{ copy.form_edit }}"
            >
              {{ copy.form_create }}
            </h2>
            <p class="modal__description">各項目を入力してタスクを作成してください。*マークが付いている項目は必須です。</p>
          </div>
          <button type="button" class="btn btn--ghost" id="cancelTaskBtn">
            {{ copy.cancel }}
          </button>
        </header>
        <input type="hidden" name="task_id" id="task_id" />

        <div class="form-grid">
          <label class="form-field">
            <span>タイトル *</span>
            <input type="text" name="title" id="title" maxlength="80" required placeholder="タスクの名前を入力してください" />
            <small class="helper-text">タスクの名前を入力してください。最大80文字。</small>
          </label>

          <label class="form-field">
            <span>担当者 *</span>
            <select name="owner_id" id="owner_id" required>
              <option value="" disabled selected>-- 選択してください --</option>
              {% for person in staff %}
              <option value="{{ person.id }}">{{ person.name }}</option>
              {% endfor %}
            </select>
            <small class="helper-text">このタスクを担当する人を選択してください。</small>
            <small id="ownerDept" class="helper-text"></small>
          </label>

          <label class="form-field">
            <span>ステータス</span>
            <select name="status" id="status">
              {% for option in status_options %}
              <option value="{{ option.value }}">{{ option.label }}</option>
              {% endfor %}
            </select>
            <small class="helper-text">タスクの進捗状況を選択してください。</small>
          </label>

          <label class="form-field">
            <span>優先度</span>
            <select name="priority" id="priority">
              {% for option in priority_options %}
              <option value="{{ option.value }}">{{ option.label }}</option>
              {% endfor %}
            </select>
            <small class="helper-text">タスクの優先度を選択してください。高、中、低から選択します。</small>
          </label>

          <label class="form-field">
            <span>象限 *</span>
            <select name="quadrant" id="quadrant">
              {% for quadrant in [1, 2, 3, 4] %}
              <option value="{{ quadrant }}">第{{ quadrant }}象限　-　{{ quadrant_labels[quadrant] }}</option>
              {% endfor %}
            </select>
            <small class="helper-text">アイゼンハワーマトリクスによる分類を選択してください。重要度と緊急度に従って選択します。</small>
          </label>

          <label class="form-field">
            <span>期限</span>
            <input type="date" name="due_date" id="due_date" />
            <small class="helper-text">タスクの期限日を選択してください。選択しない場合は空でも構いません。</small>
          </label>

          <label class="form-field">
            <span>作成者</span>
            <input type="text" name="created_by" id="created_by" placeholder="タスクを作成した人の名前" />
            <small class="helper-text">このタスクを作成した人の名前を入力してください。選択しない場合は空でも構いません。</small>
          </label>
        </div>

        <label class="form-field">
          <span>詳細</span>
          <textarea name="description" id="description" rows="4" maxlength="500" placeholder="タスクの詳細な内容を入力してください"></textarea>
          <small class="helper-text">タスクの詳細な内容を入力してください。最大500文字。選択しない場合は空でも構いません。</small>
        </label>

        <footer class="modal__footer">
          <span id="formStatus" class="form-status" role="status"></span>
          <div class="modal__actions">
            <button type="button" class="btn btn--danger" id="deleteTaskBtn">
              {{ copy.delete_task }}
            </button>
            <button type="submit" class="btn btn--primary">{{ copy.save_task }}</button>
          </div>
        </footer>
      </form>
    </dialog>

    <dialog id="staffDialog" class="modal">
      <form id="staffForm" method="dialog" enctype="multipart/form-data">
        <header class="modal__header">
          <div>
            <h2>メンバーを追加</h2>
            <p class="modal__description">メンバー情報と各象限用のアバター画像を追加してください。*マークが付いている項目は必須です。</p>
          </div>
          <button type="button" class="btn btn--ghost" id="cancelStaffBtn">
            {{ copy.cancel }}
          </button>
        </header>

        <div class="form-grid">
          <label class="form-field">
            <span>名前 *</span>
            <input type="text" name="name" id="staff_name" maxlength="50" required placeholder="メンバーの名前を入力してください" />
            <small class="helper-text">メンバーの名前を入力してください。最大50文字。</small>
          </label>

          <label class="form-field">
            <span>所属部署</span>
            <input type="text" name="department" id="staff_department" maxlength="50" placeholder="所属部署を入力してください" />
            <small class="helper-text">所属部署を入力してください。任意項目です。</small>
          </label>
        </div>

        <div class="form-grid">
          <label class="form-field">
            <span>第1象限用アバター（重要かつ緊急）</span>
            <input type="file" name="photo_q1" id="staff_photo_q1" accept="image/*" />
            <small class="helper-text">焦っている表情のアバター画像をアップロードしてください。</small>
          </label>

          <label class="form-field">
            <span>第2象限用アバター（重要だが緊急ではない）</span>
            <input type="file" name="photo_q2" id="staff_photo_q2" accept="image/*" />
            <small class="helper-text">計画的に進める表情のアバター画像をアップロードしてください。</small>
          </label>

          <label class="form-field">
            <span>第3象限用アバター（緊急だが重要ではない）</span>
            <input type="file" name="photo_q3" id="staff_photo_q3" accept="image/*" />
            <small class="helper-text">困っている表情のアバター画像をアップロードしてください。</small>
          </label>

          <label class="form-field">
            <span>第4象限用アバター（重要でも緊急でもない）</span>
            <input type="file" name="photo_q4" id="staff_photo_q4" accept="image/*" />
            <small class="helper-text">穏やかな表情のアバター画像をアップロードしてください。</small>
          </label>
        </div>

        <footer class="modal__footer">
          <span id="staffFormStatus" class="form-status" role="status"></span>
          <div class="modal__actions">
            <button type="submit" class="btn btn--primary">追加</button>
          </div>
        </footer>
      </form>
    </dialog>

    <dialog id="confirmDialog" class="modal modal--confirm">
      <div class="modal__body">
        <p id="confirmMessage">{{ copy.confirm_delete }}</p>
      </div>
      <div class="modal__actions">
        <button type="button" class="btn btn--ghost" id="confirmCancelBtn">
          {{ copy.cancel }}
        </button>
        <button type="button" class="btn btn--danger" id="confirmDeleteBtn">
          {{ copy.confirm }}
        </button>
      </div>
    </dialog>

    <footer class="page-footer">
      <p>{{ copy.footnote }}</p>
    </footer>

    <script id="initial-data" type="application/json">{{ initial_payload | tojson }}</script>
    <script src="/static/app.js" defer></script>
  </body>
</html>
